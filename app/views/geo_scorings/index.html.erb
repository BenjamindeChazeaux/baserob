<div class="dashboard-container">
  <div class="main-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-top">
        <div class="welcome-text">
          <h1>Analysis of <span class="gradient-text">positioning</span></h1>
          <p class="date"><%= Date.today.strftime("%A %d %B %Y") %></p>
        </div>
      </div>

      <!-- Search bar -->
      <div class="search-bar-container">
        <div class="search-bar modern-search-bar">
          <i class="fas fa-search"></i>
          <%= form_with url: geo_scorings_path, method: :get, local: true, class: "search-form" do |f| %>
            <%= f.select :keyword_id,
                        options_from_collection_for_select(@keywords, :id, :content, @selected_keyword&.id),
                        { include_blank: "Search for a keyword..." },
                        {
                          class: "search-input modern-input",
                          onchange: "this.form.submit()"
                        }
            %>
          <% end %>
        </div>
      </div>
    </header>

    <% if @keywords.present? && @selected_keyword.present? %>
      <div class="dashboard-sections">
        <!-- Overview section -->
        <section class="info-section">
          <div class="cards-grid">
            <!-- Global score card -->
            <div class="action-card">
              <div class="card-front">
                <div class="card-header">
                  <h3>Global Score</h3>
                </div>
                <div class="score-display">
                  <div class="score-circle <%= score_color_class(@global_score) %>">
                    <span class="score-value"><%= @global_score %>%</span>
                    <% if @global_trend %>
                      <span class="trend-indicator"><%= @global_trend %></span>
                    <% end %>
                  </div>
                  <p class="score-label">Average positioning score</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Results section -->
        <section class="results-section">
          <div class="section-header">
            <h2>Results by AI Provider</h2>
            <p>Detailed score analysis</p>
          </div>
          <div class="cards-grid">
            <% @providers.each do |provider| %>
              <div class="action-card">
                <div class="card-front">
                  <div class="card-header">
                    <h3><%= provider[:name].capitalize %></h3>
                    <img src="<%= asset_path("#{provider[:name].downcase}_logo.png") %>" alt="<%= provider[:name] %> logo" class="provider-logo">
                  </div>
                  <div class="score-display">
                    <div class="score-circle <%= score_color_class(provider[:global_score]) %>">
                      <span class="score-value"><%= provider[:global_score] %>%</span>
                      <% if provider[:trends][:global_score] %>
                        <span class="trend-indicator"><%= provider[:trends][:global_score] %></span>
                      <% end %>
                    </div>
                    <p class="score-label">Global Score</p>
                  </div>
                </div>
                <div class="card-back">
                  <div class="card-header">
                    <h3>Details for <%= provider[:name].capitalize %></h3>
                  </div>
                  <div class="details-content">
                    <ul>
                      <li><strong>Position Score:</strong> <%= provider[:position_score] %>%
                        <% if provider[:trends][:position_score] %> <%= provider[:trends][:position_score] %> <% end %></li>
                      <li><strong>URL Score:</strong> <%= provider[:url_score] %>%
                        <% if provider[:trends][:url_score] %> <%= provider[:trends][:url_score] %> <% end %></li>
                      <li><strong>Frequency Score:</strong> <%= provider[:frequency_score] %>%
                        <% if provider[:trends][:frequency_score] %> <%= provider[:trends][:frequency_score] %> <% end %></li>
                    </ul>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </section>
      </div>
    <% else %>
      <div class="empty-state">
        <div class="empty-state-content">
          <i class="fas fa-search"></i>
          <h3>No keyword selected</h3>
          <p>Please select a keyword in the search bar above to see the positioning analysis.</p>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .trend-indicator {
    font-size: 1.5rem;
    font-weight: bold;
    margin-left: 10px;
  }

  .score-circle {
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>
