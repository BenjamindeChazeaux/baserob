<div class="chart-section">
  <div class="search-filters">
    <div class="filters-header">
      <h3>Filter Analytics</h3>
      <p>Customize your view</p>
    </div>
    
    <div class="filters-form"
         data-controller="requests-stream"
         data-requests-stream-company-id-value="<%= @company&.id %>">
      <%= simple_form_for :search,
                          url: requests_path,
                          method: :get,
                          html: {
                            class: 'form-inline filters-grid',
                            data: {
                              requests_stream_target: 'form',
                              turbo_frame: 'request-chart'
                            }
                          } do |f| %>
        <%= f.input :ai_provider,
                    collection: AiProvider.all,
                    include_blank: "All AI Providers",
                    wrapper_html: {
                      class: 'modern-search-bar'
                    },
                    input_html: {
                      class: 'form-control',
                      value: params.dig(:search, :ai_provider),
                      data: { action: 'change->requests-stream#submitForm' }
                    } %>
        <%= f.input :timeline,
                    collection: [
                      ['Today', 'today'],
                      ['1 Week', '1_week'],
                      ['1 Month', '1_month'],
                      ['3 Months', '3_months'],
                      ['6 Months', '6_months']
                    ],
                    include_blank: "Select Time",
                    wrapper_html: {
                      class: 'modern-search-bar'
                    },
                    input_html: {
                      class: 'form-control',
                      value: params.dig(:search, :timeline),
                      data: { action: 'change->requests-stream#submitForm' }
                    } %>
      <% end %>
    </div>
  </div>

  <turbo-frame id="request-chart">
    <div class="chart-container-wrapper">
      <div class="card hoverable">
        <div class="card-header">
          <h3>Requests Over Time</h3>
          <div class="chart-actions">
            <button class="btn-icon" title="Download data">
              <i class="fas fa-download"></i>
            </button>
            <button class="btn-icon" title="Expand chart">
              <i class="fas fa-expand"></i>
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-container" style="height: 450px;">
            <%= line_chart @requests_by_date_and_ai_provider, 
                curve: false,
                points: false,
                height: "450px",
                colors: ["#d88c9a", "#f2d0a9", "#f1e3d3", "#99c1b9", "#8e7dbe", "#EC4899"],
                library: {
                  chart: {
                    backgroundColor: '#f8f9fa',
                    borderRadius: 2
                  },
                  title: {
                    text: nil
                  },
                  legend: {
                    align: 'center',
                    verticalAlign: 'bottom',
                    layout: 'horizontal',
                    symbolHeight: 12,
                    symbolWidth: 12,
                    symbolRadius: 6
                  },
                  xAxis: {
                    labels: {
                      style: {
                        fontSize: '12px'
                      }
                    }
                  },
                  yAxis: {
                    title: {
                      text: 'Number of Visits'
                    },
                    min: 0
                  },
                  tooltip: {
                    shared: true,
                    crosshairs: true
                  }
                },
                xtitle: "Time", 
                ytitle: "Visits", 
                id: 'requests' %>
          </div>
        </div>
      </div>
    </div>
  </turbo-frame>
</div> 